<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minecraft Domain → IP & Network Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .kbd{border:1px solid #cbd5e1;border-bottom-width:2px;border-radius:.375rem;padding:.1rem .35rem;background:#f8fafc;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:.8rem}
      .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
      .scroll-shadow{mask-image:linear-gradient(to bottom, rgba(0,0,0,1) 70%, rgba(0,0,0,0));}
      summary::marker{content:""}
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 text-slate-900">
    <div class="max-w-7xl mx-auto p-6">
      <header class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Minecraft Domain → IP & Network Analyzer</h1>
        <p class="text-slate-600 mt-2">Resolve hostnames, query multiple Minecraft/Network APIs, geolocate IPs, inspect ASN/WHOIS, and optionally run port scans with live logs. Export everything as JSON.</p>
      </header>

      <form id="resolver-form" class="grid gap-3 md:grid-cols-[1fr_auto] items-center bg-white rounded-2xl p-4 shadow">
        <input id="host-input" class="w-full rounded-xl border p-3 outline-none focus:ring-2 focus:ring-slate-400" placeholder="e.g. play.example.net" />
        <button type="submit" id="resolve-btn" class="mt-2 md:mt-0 inline-flex items-center justify-center gap-2 px-5 py-3 rounded-xl bg-slate-900 text-white hover:bg-slate-800 shadow">Resolve</button>
      </form>

      <div id="error" class="hidden mt-4 p-4 rounded-xl bg-red-50 text-red-800 border border-red-200"></div>

      <section id="results" class="hidden mt-6 bg-white rounded-2xl shadow overflow-hidden"></section>

      <footer class="mt-10 text-xs text-slate-500">
        Notes: Browser-based port scans are best-effort and may be inaccurate due to CORS/TLS/mixed-content restrictions. Optional deep scans are user-initiated only.
      </footer>
    </div>

    <script>
      const q = sel => document.querySelector(sel);
      const el = (tag, cls="", html="") => { const e=document.createElement(tag); if(cls) e.className=cls; if(html) e.innerHTML=html; return e; };

      const form = q('#resolver-form');
      const input = q('#host-input');
      const btn = q('#resolve-btn');
      const results = q('#results');
      const errorBox = q('#error');

      async function dohGoogle(name, type){
        const url = `https://dns.google/resolve?name=${encodeURIComponent(name)}&type=${encodeURIComponent(type)}`;
        const r = await fetch(url,{headers:{accept:'application/dns-json'}}); if(!r.ok) throw new Error(`Google DoH ${type} failed (${r.status})`); return r.json();
      }
      async function dohCF(name, type){
        const url = `https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(name)}&type=${encodeURIComponent(type)}`;
        const r = await fetch(url,{headers:{accept:'application/dns-json'}}); if(!r.ok) throw new Error(`Cloudflare DoH ${type} failed (${r.status})`); return r.json();
      }
      function parseAnswers(ans, type){ if(!ans) return []; return ans.map(a=>{ if(type==='SRV'&&a.type===33) return a.data; if(type==='A'&&a.type===1) return a.data; if(type==='AAAA'&&a.type===28) return a.data; if(type==='CNAME'&&a.type===5) return a.data; if(type==='PTR'&&a.type===12) return a.data; }).filter(Boolean); }

      async function fetchJSON(url){ try{ const r=await fetch(url); if(!r.ok) throw 0; return await r.json(); }catch{ return null; } }

      async function queryMinecraftAPIs(host, port){
        const urls = [
          `https://api.mcsrvstat.us/2/${host}:${port}`,
          `https://api.minetools.eu/ping/${host}/${port}`,
          `https://mc-api.co/v1/ping/${host}:${port}`,
          `https://mcapi.tcmod.xyz/${host}:${port}`,
          `https://api.mcstatus.io/v2/status/java/${host}:${port}`,
          `https://api.mcstatus.net/status/java/${host}:${port}`,
          `https://minecraft-api.com/api/ping/${host}/${port}`
        ];
        const out=[]; for(const u of urls){ const j=await fetchJSON(u); if(j) out.push({url:u, data:j}); } return out;
      }

      async function queryIPIntel(ip){
        const [ipwhois, ipapi, bgp] = await Promise.all([
          fetchJSON(`https://ipwhois.app/json/${ip}`),
          fetchJSON(`https://ip-api.com/json/${ip}?fields=status,message,continent,country,regionName,city,lat,lon,isp,org,as,asname,reverse,hosting,proxy,query`),
          fetchJSON(`https://bgp.tools/prefix/${ip}`)
        ]);
        return { ipwhois, ipapi, bgp };
      }

      async function queryMojangStatus(){
        return await fetchJSON('https://status.mojang.com/check');
      }

      function ssllabsLink(host){ return `https://www.ssllabs.com/ssltest/analyze.html?hideResults=on&d=${encodeURIComponent(host)}`; }

      const COMMON_PORTS = [20,21,22,25,53,80,110,123,143,161,389,443,465,587,993,995,1025,1433,1521,1723,1883,2082,2083,2086,2087,2096,27015,25565,3000,3306,3389,5432,5900,6379,8080,8443,9000,9200,10000,19132];

      async function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

      function logLine(container, text){ const li=el('div','mono text-xs'); li.textContent=text; container.appendChild(li); container.scrollTop=container.scrollHeight; }

      async function testPort(ip, port, logEl){
        const label = `${ip}:${port}`;
        logEl && logLine(logEl, `Scanning ${label}…`);
        let open=false;
        try{
          const controller = new AbortController();
          const t = setTimeout(()=>controller.abort(), 900);
          await fetch(`https://${ip}:${port}`, {mode:'no-cors', signal:controller.signal});
          clearTimeout(t);
          open=true;
        }catch{ /* closed / blocked */ }
        logEl && logLine(logEl, `${label} → ${open? 'open/likely' : 'closed/unknown'}`);
        return open;
      }

      async function scanPorts(ip, {mode='common', range=''}={}, onProgress){
        let ports=[];
        if(mode==='common') ports = COMMON_PORTS;
        else if(mode==='full') ports = Array.from({length:65535}, (_,i)=>i+1);
        else if(mode==='custom'){
          const set=new Set();
          range.split(',').forEach(part=>{ part=part.trim(); if(!part) return; if(part.includes('-')){ const [a,b]=part.split('-').map(n=>parseInt(n,10)); const s=Math.min(a,b), e=Math.max(a,b); for(let p=s;p<=e;p++) set.add(p);} else { const p=parseInt(part,10); if(p>=1&&p<=65535) set.add(p);} });
          ports=[...set].sort((a,b)=>a-b);
        }
        const open=[]; let i=0;
        for(const p of ports){ const isOpen = await testPort(ip, p, onProgress?.logEl); if(isOpen) open.push(p); i++; if(onProgress){ const pct=Math.round((i/ports.length)*100); onProgress.update(pct, i, ports.length); } }
        return open;
      }

      async function latencyTo(ip, port){
        const url = `https://${ip}:${port}`;
        const t0=performance.now();
        try{ await fetch(url,{mode:'no-cors'}); }catch{} finally{ return Math.round(performance.now()-t0);} }

      function pill(text){ return `<span class=\"inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-slate-100 border\">${text}</span>`; }

      function renderAPICard(api){
        const d = api.data;
        const version = (d?.version && (d.version.name || d.version.name_clean || d.version.raw || (typeof d.version === 'string' ? d.version : null))) ||
                        (d?.protocol && d?.protocol?.name) ||
                        d?.mcversion || d?.server?.version || d?.version_text || null;
        const players = d?.players?.online!=null? `${d.players.online}/${d.players.max??'?'}` : (d?.online!=null? (d.online? 'online':'offline') : null);
        const motd = d?.motd?.clean || d?.motd?.text || d?.motd?.raw || d?.motd_clean || d?.description?.text || '';
        const ipShown = d?.ip || d?.host || d?.address || '';
        return `
          <div class=\"p-4\">
            <div class=\"text-xs uppercase tracking-wide text-slate-400 mb-1\">API Source</div>
            <div class=\"text-sm text-slate-500 mb-2\">${api.url}</div>
            ${version? `<div><span class=\"font-semibold\">Version:</span> ${version}</div>`:''}
            ${players? `<div><span class=\"font-semibold\">Players:</span> ${players}</div>`:''}
            ${motd? `<div class=\"mt-1\"><span class=\"font-semibold\">MOTD:</span> ${motd}</div>`:''}
            ${ipShown? `<div class=\"mt-1\"><span class=\"font-semibold\">Reported:</span> ${ipShown}</div>`:''}
            <details class=\"mt-2\">
              <summary class=\"cursor-pointer text-sm text-slate-600\">Raw JSON</summary>
              <pre class=\"mt-1 text-xs bg-slate-100 rounded p-2 overflow-x-auto\">${escapeHtml(JSON.stringify(api.data, null, 2))}</pre>
            </details>
          </div>`;
      }

      function escapeHtml(s){ return s.replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c])); }

      function copy(text){ navigator.clipboard?.writeText(text); }

      function exportJSON(filename, data){ const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); URL.revokeObjectURL(a.href); }

      form.addEventListener('submit', async e => {
        e.preventDefault();
        results.classList.add('hidden');
        errorBox.classList.add('hidden'); errorBox.textContent='';
        btn.disabled=true; btn.textContent='Resolving…';

        const inputHost = input.value.trim().replace(/^minecraft:\/\//i,'');
        if(!inputHost){ errorBox.textContent='Please enter a host'; errorBox.classList.remove('hidden'); btn.disabled=false; btn.textContent='Resolve'; return; }

        try{
          const srvName = `_minecraft._tcp.${inputHost.replace(/\.$/,'')}`;
          let port = 25565; let finalTarget=inputHost; let srvTarget=null;

          try{
            const srvResp = await dohGoogle(srvName,'SRV');
            const srv = parseAnswers(srvResp.Answer,'SRV')[0];
            if(srv){ const parts=srv.split(/\s+/); const p=Number(parts[2]); const t=parts[3]?.replace(/\.$/,''); if(t&&Number.isFinite(p)){ port=p; finalTarget=t; srvTarget=t; } }
          }catch{}

          const [aG, aC, aaaaG, aaaaC] = await Promise.allSettled([
            dohGoogle(finalTarget,'A'), dohCF(finalTarget,'A'), dohGoogle(finalTarget,'AAAA'), dohCF(finalTarget,'AAAA')
          ]);
          const A = [ ...(aG.value?parseAnswers(aG.value.Answer,'A'):[]), ...(aC.value?parseAnswers(aC.value.Answer,'A'):[]) ];
          const AAAA = [ ...(aaaaG.value?parseAnswers(aaaaG.value.Answer,'AAAA'):[]), ...(aaaaC.value?parseAnswers(aaaaC.value.Answer,'AAAA'):[]) ];
          const ipv4=[...new Set(A)]; const ipv6=[...new Set(AAAA)];

          const [mcApis, mojang] = await Promise.all([
            queryMinecraftAPIs(finalTarget, port),
            queryMojangStatus()
          ]);

          const container = el('div','');
          container.innerHTML = `
            <div class=\"p-4 grid gap-4 md:grid-cols-3\">
              <div class=\"md:col-span-2\">
                <div class=\"text-sm text-slate-500\">Resolved Host</div>
                <div class=\"font-semibold text-lg flex items-center gap-2\">${finalTarget}
                  <button class=\"text-xs px-2 py-1 rounded bg-slate-100 border\" id=\"copy-host\">Copy</button>
                </div>
                <div class=\"text-sm mt-1\">Port: <span class=\"font-semibold\">${port}</span></div>
                ${srvTarget? `<div class=\"text-sm text-slate-600\">SRV target: <code class=\"mono\">${srvTarget}</code></div>`:''}
                <div class=\"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3\">
                  <div>
                    <div class=\"font-semibold mb-1\">IPv4 (A)</div>
                    ${ipv4.length? `<ul class=\"list-disc ml-5\">${ipv4.map(ip=>`<li><code class='mono'>${ip}</code> <button data-ip='${ip}' class='copy-ip text-xs ml-2 px-2 py-0.5 rounded bg-slate-100 border'>Copy</button></li>`).join('')}</ul>` : '<div class=\"text-slate-500 text-sm\">No A records</div>'}
                  </div>
                  <div>
                    <div class=\"font-semibold mb-1\">IPv6 (AAAA)</div>
                    ${ipv6.length? `<ul class=\"list-disc ml-5\">${ipv6.map(ip=>`<li><code class='mono'>${ip}</code></li>`).join('')}</ul>` : '<div class=\"text-slate-500 text-sm\">No AAAA records</div>'}
                  </div>
                </div>
                <div class=\"mt-3 text-xs text-slate-500\">Mojang Status: ${Array.isArray(mojang)? mojang.map(obj=>{ const [svc,state] = Object.entries(obj)[0]; return pill(`${svc}:${state}`); }).join(' ') : 'n/a'}</div>
                <div class=\"mt-2 text-xs\"><a class=\"text-blue-600 hover:underline\" href=\"${ssllabsLink(finalTarget)}\" target=\"_blank\">Check SSL/TLS report (SSL Labs)</a></div>
              </div>
              <div class=\"md:col-span-1 bg-slate-50 border rounded-xl p-3\">
                <div class=\"font-semibold\">Actions</div>
                <div class=\"mt-2 space-y-2\">
                  <button id=\"scan-common\" class=\"w-full px-3 py-2 rounded bg-slate-900 text-white hover:bg-slate-800\">Scan Common Ports</button>
                  <div class=\"grid grid-cols-[1fr_auto] gap-2 items-center\">
                    <input id=\"custom-range\" class=\"rounded border p-2\" placeholder=\"e.g. 1-1024, 25565, 8080-8090\" />
                    <button id=\"scan-custom\" class=\"px-3 py-2 rounded bg-slate-800 text-white hover:bg-slate-700\">Custom</button>
                  </div>
                  <button id=\"scan-full\" class=\"w-full px-3 py-2 rounded bg-slate-700 text-white hover:bg-slate-600\" title=\"Optional, after a common scan\">Scan ALL Ports (1–65535)</button>
                  <button id=\"export-json\" class=\"w-full px-3 py-2 rounded bg-slate-100 border\">Export JSON</button>
                </div>
              </div>
            </div>

            <div class=\"border-t grid md:grid-cols-2\">
              <div class=\"p-4\">
                <h3 class=\"font-semibold\">IP Intelligence & Geolocation</h3>
                <div id=\"ip-cards\" class=\"mt-2 grid gap-3\"></div>
              </div>
              <div class=\"p-4 border-l\">
                <h3 class=\"font-semibold\">Port Scan Log</h3>
                <div class=\"mt-2\">
                  <div class=\"w-full h-2 bg-slate-100 rounded\"><div id=\"scan-bar\" class=\"h-2 bg-slate-900 rounded\" style=\"width:0%\"></div></div>
                  <div class=\"mt-1 text-xs text-slate-600\"><span id=\"scan-progress\">0%</span> • <span id=\"scan-count\">0/0</span></div>
                  <div id=\"scan-log\" class=\"mt-2 h-44 overflow-auto bg-slate-50 border rounded p-2 scroll-shadow\"></div>
                  <div id=\"scan-open\" class=\"mt-2 text-sm\"></div>
                  <div id=\"latency-box\" class=\"mt-3 text-xs text-slate-600\"></div>
                </div>
              </div>
            </div>

            <div class=\"border-t\">
              <div class=\"p-4\">
                <h3 class=\"font-semibold\">Minecraft Status APIs</h3>
                <div class=\"divide-y\">${mcApis.map(renderAPICard).join('')}</div>
              </div>
            </div>
          `;

          const ipCards = container.querySelector('#ip-cards');
          const ipIntelAll = [];
          for(const ip of ipv4){
            const intel = await queryIPIntel(ip);
            ipIntelAll.push({ip, ...intel});
            const lat = intel.ipapi?.lat ?? intel.ipwhois?.latitude;
            const lon = intel.ipapi?.lon ?? intel.ipwhois?.longitude;
            const city = intel.ipapi?.city || intel.ipwhois?.city || '';
            const country = intel.ipapi?.country || intel.ipwhois?.country || '';
            const isp = intel.ipapi?.isp || intel.ipwhois?.isp || intel.ipapi?.org || '';
            const asn = intel.bgp?.data?.prefixes?.[0]?.asn?.asn || intel.ipapi?.as || '';
            const reverse = intel.ipapi?.reverse || '';

            const card = el('div','border rounded-xl p-3 bg-white');
            card.innerHTML = `
              <div class=\"flex items-center justify-between\">
                <div class=\"font-semibold mono\">${ip}</div>
                <div class=\"flex gap-2\">
                  <a class=\"text-blue-600 hover:underline text-sm\" target=\"_blank\" href=\"https://ipinfo.io/${ip}\">ipinfo</a>
                  <a class=\"text-blue-600 hover:underline text-sm\" target=\"_blank\" href=\"https://bgp.tools/prefix/${ip}\">BGP</a>
                </div>
              </div>
              <div class=\"text-sm mt-1\">${reverse?`PTR: <span class='mono'>${reverse}</span>`:''}</div>
              <div class=\"text-sm mt-1\">${city||country?`Location: ${city?city+', ':''}${country}`:''} ${isp?`• ISP: ${isp}`:''} ${asn?`• ASN: ${asn}`:''}</div>
              ${lat&&lon? `<iframe class=\"mt-2 w-full h-48 rounded\" src=\"https://maps.google.com/maps?q=${lat},${lon}&z=5&output=embed\"></iframe>`:''}
            `;
            ipCards.appendChild(card);
          }

          container.querySelector('#copy-host')?.addEventListener('click', ()=>copy(finalTarget));
          container.querySelectorAll('.copy-ip').forEach(b=> b.addEventListener('click', ()=>copy(b.getAttribute('data-ip'))));

          const scanBar = container.querySelector('#scan-bar');
          const scanProg = container.querySelector('#scan-progress');
          const scanCount = container.querySelector('#scan-count');
          const scanLog = container.querySelector('#scan-log');
          const scanOpen = container.querySelector('#scan-open');
          const latencyBox = container.querySelector('#latency-box');

          let lastScanResult = { open: [], mode: 'none' };

          async function runScan(mode, customRange=''){
            scanLog.innerHTML=''; scanOpen.textContent='';
            scanBar.style.width='0%'; scanProg.textContent='0%'; scanCount.textContent='0/0';

            const ip = ipv4[0]; if(!ip){ logLine(scanLog,'No IPv4 to scan.'); return; }
            const onProgress={
              logEl: scanLog,
              update:(pct, i, total)=>{ scanBar.style.width=pct+'%'; scanProg.textContent=pct+'%'; scanCount.textContent=`${i}/${total}`; }
            };
            const open = await scanPorts(ip, {mode, range:customRange}, onProgress);
            lastScanResult = { open, mode, ip, ts: Date.now() };
            scanOpen.innerHTML = `<div class='text-sm'>Open ports: ${open.length? open.map(p=>pill(p)).join(' ') : '<span class=\"text-slate-500\">none detected</span>'}</div>`;

            const interesting = [port, 80, 443, 25565].filter((p,idx,self)=>self.indexOf(p)===idx);
            const res=[]; for(const p of interesting){ const ms=await latencyTo(ip,p); res.push(`${p}: ${ms} ms`);} latencyBox.textContent = `Latency (best-effort): ${res.join(' • ')}`;
          }

          container.querySelector('#scan-common').addEventListener('click', ()=>runScan('common'));
          container.querySelector('#scan-full').addEventListener('click', ()=>runScan('full'));
          container.querySelector('#scan-custom').addEventListener('click', ()=>{
            const cr = container.querySelector('#custom-range').value.trim(); if(!cr){ alert('Enter ports or ranges e.g. 1-1024, 25565, 8080-8090'); return; } runScan('custom', cr);
          });

          container.querySelector('#export-json').addEventListener('click', ()=>{
            const payload = {
              host: finalTarget, port, srvTarget, ipv4, ipv6, mojang, mcApis, ipIntel: ipIntelAll, lastScanResult
            };
            exportJSON(`report_${finalTarget.replace(/[^a-z0-9.-]/gi,'_')}.json`, payload);
          });

          results.innerHTML=''; results.appendChild(container); results.classList.remove('hidden');
        }catch(err){ errorBox.textContent = err.message || 'Error resolving host.'; errorBox.classList.remove('hidden'); }
        btn.disabled=false; btn.textContent='Resolve';
      });
    </script>
  </body>
</html>
